{% extends "layouts/dashboard_layout.html" %}

{% block title %}Kronos æ™ºèƒ½æŠ•èµ„å¹³å° - é¦–é¡µ{% endblock %}

{% block page_title %}æ™ºèƒ½è‚¡ç¥¨é¢„æµ‹{% endblock %}
{% block page_subtitle %}åŸºäºå…ˆè¿›AIæ¨¡å‹çš„æ™ºèƒ½æŠ•èµ„å†³ç­–å¹³å°{% endblock %}

{% block page_actions %}
<button class="btn btn-primary btn-lg" onclick="scrollToPredictionForm()">
    <i class="fas fa-magic"></i>
    å¼€å§‹æ™ºèƒ½é¢„æµ‹
</button>
<button class="btn btn-secondary" onclick="scrollToMarketOverview()">
    <i class="fas fa-chart-area"></i>
    å¸‚åœºæ¦‚è§ˆ
</button>
<button class="btn btn-success" onclick="scrollToHotStocks()">
    <i class="fas fa-fire"></i>
    çƒ­é—¨è‚¡ç¥¨
</button>
{% endblock %}

{% block content %}
<!-- Quick Stats Banner -->
<div class="stats-banner">
    <div class="stat-card">
        <div class="stat-icon success">
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">256</div>
            <div class="stat-label">ä»Šæ—¥é¢„æµ‹</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon primary">
            <i class="fas fa-bullseye"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">87.3%</div>
            <div class="stat-label">é¢„æµ‹å‡†ç¡®ç‡</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon warning">
            <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">12,489</div>
            <div class="stat-label">æ´»è·ƒç”¨æˆ·</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon danger">
            <i class="fas fa-coins"></i>
        </div>
        <div class="stat-content">
            <div class="stat-value">Â¥2.8M</div>
            <div class="stat-label">ç´¯è®¡æ”¶ç›Š</div>
        </div>
    </div>
</div>

<!-- Main Prediction Area -->
<div class="prediction-container" id="prediction-area">
    <div class="prediction-header">
        <h2>
            <i class="fas fa-brain text-primary"></i>
            AIæ™ºèƒ½é¢„æµ‹ <span class="badge badge-demo">æ¼”ç¤ºç‰ˆæœ¬</span>
        </h2>
        <p>é€‰æ‹©è‚¡ç¥¨ä»£ç ï¼Œè·å–åŸºäºå¤šæ¨¡å‹åˆ†æçš„é¢„æµ‹ç»“æœ (å½“å‰ä½¿ç”¨Mockæ•°æ®æ¼”ç¤º)</p>
    </div>
    
    <div class="prediction-form-card">
        <form hx-post="/components/mock-prediction-result"
              hx-target="#prediction-results"
              hx-indicator=".prediction-btn">
            <div class="form-row">
                <div class="form-group">
                    <label for="stock_symbol">è‚¡ç¥¨ä»£ç </label>
                    <div class="input-group">
                        <input type="text" 
                               id="stock_symbol" 
                               name="stock_symbol" 
                               class="form-control" 
                               placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç ï¼Œå¦‚ 000001"
                               hx-get="/api/stocks/search"
                               hx-trigger="input changed delay:500ms, search"
                               hx-target="#suggestions"
                               hx-include="[name='stock_symbol']"
                               autocomplete="off"
                               required>
                        <button type="button" class="btn-input-addon" onclick="showHotStocks()">
                            <i class="fas fa-fire"></i>
                        </button>
                    </div>
                    <div id="suggestions" class="suggestions-dropdown" style="display: none;"
                         hx-target="this"
                         hx-swap="innerHTML">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="model_type">é¢„æµ‹æ¨¡å‹</label>
                    <select id="model_type" name="model_type" class="form-control" required>
                        <option value="">é€‰æ‹©æ¨¡å‹</option>
                        <option value="kronos-base">Kronos Base (å¹³è¡¡å‹)</option>
                        <option value="kronos-mini">Kronos Mini (å¿«é€Ÿå‹)</option>
                        <option value="kronos-small">Kronos Small (ç²¾å‡†å‹)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="prediction_days">é¢„æµ‹å¤©æ•°</label>
                    <select id="prediction_days" name="prediction_days" class="form-control">
                        <option value="1">1å¤©</option>
                        <option value="3">3å¤©</option>
                        <option value="5" selected>5å¤©</option>
                        <option value="10">10å¤©</option>
                        <option value="30">30å¤©</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-lg prediction-btn">
                        <i class="fas fa-magic"></i>
                        <span>å¼€å§‹é¢„æµ‹</span>
                        <div id="prediction-loading" class="htmx-indicator">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Prediction Results -->
<div id="prediction-results" class="prediction-results">
    <!-- Results will be loaded here via HTMX -->
</div>

<!-- Recent Predictions -->
<div class="recent-predictions">
    <div class="section-header">
        <h3>
            <i class="fas fa-history text-secondary"></i>
            æœ€è¿‘é¢„æµ‹
        </h3>
        <a href="/history" class="btn btn-secondary btn-sm">æŸ¥çœ‹å…¨éƒ¨</a>
    </div>
    
    <div class="predictions-grid" id="recent-predictions-grid"
         hx-get="/components/recent-predictions"
         hx-trigger="load">
        <div class="loading-placeholder">
            <div class="skeleton prediction-card"></div>
            <div class="skeleton prediction-card"></div>
            <div class="skeleton prediction-card"></div>
        </div>
    </div>
</div>

<!-- Popular Stocks -->
<div class="popular-stocks">
    <div class="section-header">
        <h3>
            <i class="fas fa-fire text-warning"></i>
            çƒ­é—¨è‚¡ç¥¨
        </h3>
        <div class="filter-tabs">
            <button class="filter-tab active" data-filter="all" onclick="filterStocks('all')">å…¨éƒ¨</button>
            <button class="filter-tab" data-filter="tech" onclick="filterStocks('tech')">ç§‘æŠ€</button>
            <button class="filter-tab" data-filter="finance" onclick="filterStocks('finance')">é‡‘è</button>
            <button class="filter-tab" data-filter="energy" onclick="filterStocks('energy')">èƒ½æº</button>
        </div>
    </div>
    
    <div class="stocks-grid" id="popular-stocks-grid"
         hx-get="/components/hot-stocks"
         hx-trigger="load">
        <div class="loading-placeholder">
            <div class="skeleton stock-card"></div>
            <div class="skeleton stock-card"></div>
            <div class="skeleton stock-card"></div>
            <div class="skeleton stock-card"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block content_sidebar %}
<!-- Usage Stats Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-chart-pie text-primary"></i>
            ä»Šæ—¥ä½¿ç”¨ç»Ÿè®¡
        </h3>
    </div>
    <div class="card-content">
        <div class="usage-stats">
            <div class="usage-item">
                <div class="usage-label">é¢„æµ‹æ¬¡æ•°</div>
                <div class="usage-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%"></div>
                    </div>
                    <span class="usage-count">6/10</span>
                </div>
            </div>
            <div class="usage-item">
                <div class="usage-label">APIè°ƒç”¨</div>
                <div class="usage-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 30%"></div>
                    </div>
                    <span class="usage-count">30/100</span>
                </div>
            </div>
            <div class="upgrade-prompt">
                <p class="text-muted">å‡çº§åˆ°ä¸“ä¸šç‰ˆï¼Œäº«å—æ›´å¤šé¢„æµ‹æ¬¡æ•°</p>
                <button class="btn btn-warning btn-sm">
                    <i class="fas fa-crown"></i>
                    ç«‹å³å‡çº§
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Market Overview Card -->
<div class="card" id="market-overview-card">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-chart-line text-success"></i>
            å¸‚åœºæ¦‚è§ˆ
        </h3>
    </div>
    <div class="card-content">
        <div class="market-stats" id="market-stats"
             hx-get="/components/market-overview"
             hx-trigger="load">
            <div class="loading-placeholder">
                <div class="skeleton stat-item" style="height: 20px; margin-bottom: 10px;"></div>
                <div class="skeleton stat-item" style="height: 20px; margin-bottom: 10px;"></div>
                <div class="skeleton stat-item" style="height: 20px; margin-bottom: 10px;"></div>
            </div>
        </div>
        <div class="market-sentiment">
            <div class="sentiment-header">å¸‚åœºæƒ…ç»ª</div>
            <div class="sentiment-bar">
                <div class="sentiment-fill bullish" style="width: 65%"></div>
            </div>
            <div class="sentiment-labels">
                <span class="text-danger">çœ‹è·Œ</span>
                <span class="text-success">çœ‹æ¶¨ 65%</span>
            </div>
        </div>
    </div>
</div>

<!-- AI Insights Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-brain text-primary"></i>
            AIå¸‚åœºæ´å¯Ÿ
        </h3>
    </div>
    <div class="card-content">
        <div class="ai-insights">
            <div class="insight-item">
                <div class="insight-icon">
                    <i class="fas fa-trending-up text-success"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-title">æ–°èƒ½æºæ¿å—æœºä¼š</div>
                    <div class="insight-desc">åŸºäºæŠ€æœ¯é¢åˆ†æï¼Œæ–°èƒ½æºæ¿å—æœ‰æœ›åœ¨æœªæ¥3-5å¤©å†…ä¸Šæ¶¨</div>
                    <div class="insight-confidence">ç½®ä¿¡åº¦: 85%</div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon">
                    <i class="fas fa-exclamation-triangle text-warning"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-title">æ¶ˆè´¹è‚¡è°ƒæ•´</div>
                    <div class="insight-desc">æ¶ˆè´¹ç±»è‚¡ç¥¨å¯èƒ½é¢ä¸´çŸ­æœŸè°ƒæ•´ï¼Œå»ºè®®è°¨æ…æ“ä½œ</div>
                    <div class="insight-confidence">ç½®ä¿¡åº¦: 72%</div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon">
                    <i class="fas fa-chart-bar text-primary"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-title">ç§‘æŠ€è‚¡éœ‡è¡</div>
                    <div class="insight-desc">ç§‘æŠ€è‚¡æ•´ä½“å¤„äºéœ‡è¡æ•´ç†é˜¶æ®µï¼Œç­‰å¾…æ–¹å‘çªç ´</div>
                    <div class="insight-confidence">ç½®ä¿¡åº¦: 78%</div>
                </div>
            </div>
        </div>
        
        <button class="btn btn-primary btn-sm" style="width: 100%; margin-top: 1rem;">
            <i class="fas fa-plus"></i>
            æŸ¥çœ‹æ›´å¤šæ´å¯Ÿ
        </button>
    </div>
</div>

<!-- Quick Actions Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-bolt text-warning"></i>
            å¿«é€Ÿæ“ä½œ
        </h3>
    </div>
    <div class="card-content">
        <div class="quick-actions">
            <button class="quick-action-btn" onclick="showStockSearch()">
                <i class="fas fa-search"></i>
                <span>æœç´¢è‚¡ç¥¨</span>
            </button>
            <button class="quick-action-btn" onclick="showWatchlist()">
                <i class="fas fa-star"></i>
                <span>æˆ‘çš„å…³æ³¨</span>
            </button>
            <button class="quick-action-btn" onclick="showAlerts()">
                <i class="fas fa-bell"></i>
                <span>ä»·æ ¼é¢„è­¦</span>
            </button>
            <button class="quick-action-btn" onclick="showHistory()">
                <i class="fas fa-history"></i>
                <span>é¢„æµ‹å†å²</span>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// ç¡¬ç¼–ç çš„è‚¡ç¥¨æ•°æ®
const stocksData = [
    { symbol: '000001', name: 'å¹³å®‰é“¶è¡Œ', price: 12.75, change: 2.34, industry: 'é“¶è¡Œä¸š' },
    { symbol: '000002', name: 'ä¸‡ç§‘A', price: 18.90, change: -1.56, industry: 'æˆ¿åœ°äº§' },
    { symbol: '600519', name: 'è´µå·èŒ…å°', price: 1695.50, change: 0.89, industry: 'é£Ÿå“é¥®æ–™' },
    { symbol: '600036', name: 'æ‹›å•†é“¶è¡Œ', price: 35.20, change: 1.78, industry: 'é“¶è¡Œä¸š' },
    { symbol: '000858', name: 'äº”ç²®æ¶²', price: 128.45, change: -0.67, industry: 'é£Ÿå“é¥®æ–™' },
    { symbol: '600031', name: 'ä¸‰ä¸€é‡å·¥', price: 18.76, change: 3.45, industry: 'æœºæ¢°è®¾å¤‡' },
    { symbol: '000063', name: 'ä¸­å…´é€šè®¯', price: 32.18, change: -2.11, industry: 'é€šä¿¡è®¾å¤‡' },
    { symbol: '002415', name: 'æµ·åº·å¨è§†', price: 45.67, change: 1.23, industry: 'ç”µå­è®¾å¤‡' },
    { symbol: '000166', name: 'ç”³ä¸‡å®æº', price: 4.56, change: 0.78, industry: 'è¯åˆ¸ä¸š' },
    { symbol: '600887', name: 'ä¼Šåˆ©è‚¡ä»½', price: 34.12, change: -0.45, industry: 'é£Ÿå“é¥®æ–™' }
];

// è‚¡ç¥¨æœç´¢åŠŸèƒ½
// æˆ‘ä»¬ç°åœ¨ä½¿ç”¨HTMXæ¥å¤„ç†è‚¡ç¥¨æœç´¢ï¼Œæ‰€ä»¥ç§»é™¤è¿™ä¸ªå‡½æ•°

function selectStock(symbol, name) {
    document.getElementById('stock_symbol').value = symbol;
    document.getElementById('suggestions').style.display = 'none';
    
    // æ˜¾ç¤ºé€‰ä¸­åŠ¨ç”»
    const input = document.getElementById('stock_symbol');
    input.style.borderColor = '#28a745';
    setTimeout(() => {
        input.style.borderColor = '';
    }, 1000);
    
    showToast(`å·²é€‰æ‹© ${symbol} ${name}`, 'success');
}

function showHotStocks() {
    const hotStocks = stocksData.slice(0, 6);
    let html = '';
    
    hotStocks.forEach(stock => {
        const changeClass = stock.change > 0 ? 'text-success' : 'text-danger';
        const changeSign = stock.change > 0 ? '+' : '';
        html += `
            <div class="suggestion-item" onclick="selectStock('${stock.symbol}', '${stock.name}')">
                <div class="stock-basic">
                    <span class="stock-code">${stock.symbol}</span>
                    <span class="stock-name">${stock.name}</span>
                    <small class="text-muted">${stock.industry}</small>
                </div>
                <div class="stock-price">
                    <span class="price">Â¥${stock.price}</span>
                    <span class="change ${changeClass}">
                        ${changeSign}${stock.change.toFixed(2)}%
                    </span>
                </div>
            </div>
        `;
    });
    
    const suggestions = document.getElementById('suggestions');
    suggestions.innerHTML = `<div style="padding: 8px; font-weight: bold; border-bottom: 1px solid #eee;">ğŸ”¥ çƒ­é—¨è‚¡ç¥¨</div>` + html;
    suggestions.style.display = 'block';
}

// ç”Ÿæˆé¢„æµ‹åŠŸèƒ½
function generatePrediction(event) {
    event.preventDefault();
    
    const form = event.target;
    const stockSymbol = form.stock_symbol.value;
    const modelType = form.model_type.value;
    const predictionDays = parseInt(form.prediction_days.value);
    
    if (!stockSymbol || !modelType || !predictionDays) {
        showToast('è¯·å¡«å†™å®Œæ•´çš„é¢„æµ‹å‚æ•°', 'error');
        return;
    }
    
    // æŸ¥æ‰¾è‚¡ç¥¨ä¿¡æ¯
    const stock = stocksData.find(s => s.symbol === stockSymbol);
    if (!stock) {
        showToast('è‚¡ç¥¨ä»£ç ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°é€‰æ‹©', 'error');
        return;
    }
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    const resultsContainer = document.getElementById('prediction-results');
    resultsContainer.innerHTML = `
        <div class="prediction-loading">
            <div class="loading-spinner">
                <i class="fas fa-brain fa-spin"></i>
            </div>
            <h4>AIæ­£åœ¨åˆ†æä¸­...</h4>
            <p>æ­£åœ¨ä½¿ç”¨ ${modelType} æ¨¡å‹åˆ†æ ${stock.name} (${stockSymbol})</p>
            <div class="loading-progress">
                <div class="progress-bar" id="loadingProgress"></div>
            </div>
        </div>
    `;
    
    // æ¨¡æ‹ŸåŠ è½½è¿›åº¦
    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += Math.random() * 20;
        if (progress > 100) progress = 100;
        document.getElementById('loadingProgress').style.width = progress + '%';
        
        if (progress >= 100) {
            clearInterval(progressInterval);
            setTimeout(() => showPredictionResult(stock, modelType, predictionDays), 500);
        }
    }, 200);
    
    // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
    resultsContainer.scrollIntoView({ behavior: 'smooth' });
}

function showPredictionResult(stock, modelType, days) {
    // ç”Ÿæˆæ¨¡æ‹Ÿé¢„æµ‹ç»“æœ
    const currentPrice = stock.price;
    const volatility = getModelVolatility(modelType);
    const changeFactor = (Math.random() - 0.5) * 2 * volatility;
    const predictedPrice = currentPrice * (1 + changeFactor);
    const confidence = getModelConfidence(modelType, days);
    const changePercent = ((predictedPrice - currentPrice) / currentPrice) * 100;
    
    const predictionId = 'pred_' + Date.now();
    const isBullish = predictedPrice > currentPrice;
    
    const resultHtml = `
        <div class="prediction-result-card" id="${predictionId}">
            <div class="result-header">
                <div class="stock-info">
                    <h3 class="stock-name">${stock.name}</h3>
                    <span class="stock-code">${stock.symbol}</span>
                    <span class="model-badge badge-${modelType.replace('-', '')}">${modelType}</span>
                </div>
                <div class="prediction-meta">
                    <span class="prediction-time">åˆšåˆšç”Ÿæˆ</span>
                    <span class="prediction-expires">${days}å¤©é¢„æµ‹</span>
                </div>
            </div>
            
            <div class="result-content">
                <!-- ä»·æ ¼å¯¹æ¯” -->
                <div class="price-comparison">
                    <div class="price-item current">
                        <label>å½“å‰ä»·æ ¼</label>
                        <span class="price-value">Â¥${currentPrice.toFixed(2)}</span>
                    </div>
                    <div class="price-arrow">
                        <i class="fas fa-arrow-${isBullish ? 'up text-success' : 'down text-danger'}"></i>
                    </div>
                    <div class="price-item predicted">
                        <label>é¢„æµ‹ä»·æ ¼</label>
                        <span class="price-value ${isBullish ? 'text-success' : 'text-danger'}">
                            Â¥${predictedPrice.toFixed(2)}
                        </span>
                    </div>
                </div>
                
                <!-- é¢„æµ‹æŒ‡æ ‡ -->
                <div class="prediction-metrics">
                    <div class="metric-item">
                        <label>é¢„æµ‹æ¶¨è·Œ</label>
                        <span class="metric-value ${isBullish ? 'text-success' : 'text-danger'}">
                            ${changePercent > 0 ? '+' : ''}${changePercent.toFixed(2)}%
                        </span>
                    </div>
                    <div class="metric-item">
                        <label>ç½®ä¿¡åº¦</label>
                        <span class="metric-value">${confidence.toFixed(1)}%</span>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidence}%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- é¢„æµ‹åˆ†æ -->
                <div class="prediction-analysis">
                    <h6>åˆ†æè¦ç‚¹</h6>
                    <ul class="analysis-points">
                        ${generateAnalysisPoints(stock, modelType, isBullish)}
                    </ul>
                </div>
                
                <!-- é£é™©æç¤º -->
                <div class="risk-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <small>é¢„æµ‹ä»…ä¾›å‚è€ƒï¼ŒæŠ•èµ„æœ‰é£é™©ï¼Œå†³ç­–éœ€è°¨æ…</small>
                </div>
            </div>
            
            <div class="result-actions">
                <button class="btn btn-outline-primary btn-sm" onclick="sharePrediction('${predictionId}')">
                    <i class="fas fa-share"></i> åˆ†äº«
                </button>
                <button class="btn btn-outline-secondary btn-sm" onclick="addToWatchlist('${stock.symbol}')">
                    <i class="fas fa-star"></i> å…³æ³¨
                </button>
                <button class="btn btn-outline-info btn-sm" onclick="showChart('${predictionId}')">
                    <i class="fas fa-chart-line"></i> å›¾è¡¨
                </button>
            </div>
        </div>
    `;
    
    document.getElementById('prediction-results').innerHTML = resultHtml;
    
    // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
    showToast('é¢„æµ‹ç”ŸæˆæˆåŠŸï¼', 'success');
    
    // ä¿å­˜åˆ°å†å²è®°å½•
    savePredictionToHistory({
        id: predictionId,
        stock: stock,
        modelType: modelType,
        days: days,
        currentPrice: currentPrice,
        predictedPrice: predictedPrice,
        confidence: confidence,
        timestamp: new Date()
    });
}

function getModelVolatility(modelType) {
    const volatilities = {
        'kronos-base': 0.15,
        'kronos-mini': 0.08,
        'kronos-small': 0.12
    };
    return volatilities[modelType] || 0.10;
}

function getModelConfidence(modelType, days) {
    const baseConfidence = {
        'kronos-base': 82,
        'kronos-mini': 75,
        'kronos-small': 88
    };
    
    const base = baseConfidence[modelType] || 75;
    const daysPenalty = Math.min(days * 1.5, 15); // é•¿æœŸé¢„æµ‹ç½®ä¿¡åº¦é™ä½
    const randomFactor = (Math.random() - 0.5) * 10;
    
    return Math.max(60, Math.min(95, base - daysPenalty + randomFactor));
}

function generateAnalysisPoints(stock, modelType, isBullish) {
    const points = [
        `åŸºäº${stock.industry}è¡Œä¸šåˆ†æï¼Œè¯¥è‚¡ç¥¨å…·æœ‰${isBullish ? 'ä¸Šæ¶¨' : 'ä¸‹è·Œ'}æ½œåŠ›`,
        `æŠ€æœ¯æŒ‡æ ‡æ˜¾ç¤º${isBullish ? 'ä¹°å…¥' : 'å–å‡º'}ä¿¡å·è¾ƒä¸ºæ˜æ˜¾`,
        `å¸‚åœºæƒ…ç»ªå¯¹è¯¥è‚¡ç¥¨å‘ˆ${isBullish ? 'ä¹è§‚' : 'è°¨æ…'}æ€åº¦`,
        `èµ„é‡‘æµå‘æ•°æ®æ”¯æŒå½“å‰${isBullish ? 'çœ‹æ¶¨' : 'çœ‹è·Œ'}åˆ¤æ–­`
    ];
    
    return points.slice(0, 3).map(point => `<li>${point}</li>`).join('');
}

// å…¶ä»–åŠŸèƒ½å‡½æ•°
function sharePrediction(predictionId) {
    if (navigator.share) {
        navigator.share({
            title: 'Kronos é¢„æµ‹ç»“æœ',
            text: 'æŸ¥çœ‹æˆ‘çš„è‚¡ç¥¨é¢„æµ‹ç»“æœ',
            url: window.location.href + '#' + predictionId
        });
    } else {
        const url = window.location.href + '#' + predictionId;
        navigator.clipboard.writeText(url).then(() => {
            showToast('é¢„æµ‹é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        });
    }
}

function addToWatchlist(symbol) {
    const watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');
    if (!watchlist.includes(symbol)) {
        watchlist.push(symbol);
        localStorage.setItem('watchlist', JSON.stringify(watchlist));
        showToast(`å·²å°† ${symbol} æ·»åŠ åˆ°å…³æ³¨åˆ—è¡¨`, 'success');
    } else {
        showToast(`${symbol} å·²åœ¨å…³æ³¨åˆ—è¡¨ä¸­`, 'info');
    }
}

function showChart(predictionId) {
    showToast('å›¾è¡¨åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...', 'info');
}

function savePredictionToHistory(prediction) {
    const history = JSON.parse(localStorage.getItem('predictionHistory') || '[]');
    history.unshift(prediction);
    if (history.length > 50) history.pop(); // ä¿ç•™æœ€è¿‘50æ¡
    localStorage.setItem('predictionHistory', JSON.stringify(history));
}

function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    const iconMap = {
        success: 'check-circle',
        error: 'times-circle',
        warning: 'exclamation-triangle',
        info: 'info-circle'
    };
    
    toast.className = `alert alert-${type} toast-message`;
    toast.innerHTML = `
        <i class="fas fa-${iconMap[type]}"></i>
        ${message}
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

function scrollToPredictionForm() {
    document.getElementById('prediction-area').scrollIntoView({ 
        behavior: 'smooth' 
    });
}

function scrollToMarketOverview() {
    document.getElementById('market-overview-card').scrollIntoView({ 
        behavior: 'smooth' 
    });
}

function scrollToHotStocks() {
    document.querySelector('.popular-stocks').scrollIntoView({ 
        behavior: 'smooth' 
    });
}

function selectStock(symbol, name) {
    document.getElementById('stock_symbol').value = symbol;
    document.getElementById('suggestions').style.display = 'none';
    
    // æ˜¾ç¤ºé€‰ä¸­åŠ¨ç”»
    const input = document.getElementById('stock_symbol');
    input.style.borderColor = '#28a745';
    setTimeout(() => {
        input.style.borderColor = '';
    }, 1000);
    
    showToast(`å·²é€‰æ‹© ${symbol} ${name}`, 'success');
}

function quickPredict(symbol) {
    document.getElementById('stock_symbol').value = symbol;
    document.getElementById('prediction-area').scrollIntoView({ behavior: 'smooth' });
    showToast(`å·²ä¸º ${symbol} é¢„å¡«å†™é¢„æµ‹è¡¨å•`, 'success');
}

function showChartPlaceholder(predictionId) {
    const button = event.target;
    const loading = document.getElementById(`chart-loading-${predictionId}`);
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    loading.classList.remove('d-none');
    button.disabled = true;
    
    // æ¨¡æ‹ŸåŠ è½½æ—¶é—´
    setTimeout(() => {
        loading.classList.add('d-none');
        button.disabled = false;
        
        // æ˜¾ç¤ºå›¾è¡¨
        const chartContainer = document.getElementById(`chart-${predictionId}`);
        chartContainer.innerHTML = `
            <div class="chart-content">
                <div class="chart-placeholder-content">
                    <i class="fas fa-chart-line"></i>
                    <p>å›¾è¡¨åŠŸèƒ½æ¼”ç¤º</p>
                    <small class="text-muted">åœ¨å®Œæ•´ç‰ˆæœ¬ä¸­å°†æ˜¾ç¤ºè¯¦ç»†çš„Kçº¿å›¾</small>
                </div>
            </div>
        `;
    }, 1500);
}

function sharePrediction(predictionId) {
    if (navigator.share) {
        navigator.share({
            title: 'Kronos é¢„æµ‹ç»“æœ',
            text: 'æŸ¥çœ‹æˆ‘çš„è‚¡ç¥¨é¢„æµ‹ç»“æœ',
            url: window.location.href + '#' + predictionId
        });
    } else {
        const url = window.location.href + '#' + predictionId;
        navigator.clipboard.writeText(url).then(() => {
            showToast('é¢„æµ‹é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        });
    }
}

function downloadReport(predictionId) {
    showToast('æŠ¥å‘Šä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...', 'info');
}

function addToWatchlist(symbol) {
    const watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');
    if (!watchlist.includes(symbol)) {
        watchlist.push(symbol);
        localStorage.setItem('watchlist', JSON.stringify(watchlist));
        showToast(`å·²å°† ${symbol} æ·»åŠ åˆ°å…³æ³¨åˆ—è¡¨`, 'success');
    } else {
        showToast(`${symbol} å·²åœ¨å…³æ³¨åˆ—è¡¨ä¸­`, 'info');
    }
}

// ç‚¹å‡»å¤–éƒ¨å…³é—­æœç´¢å»ºè®®
document.addEventListener('click', function(e) {
    const suggestions = document.getElementById('suggestions');
    const stockInput = document.getElementById('stock_symbol');
    
    if (!suggestions.contains(e.target) && e.target !== stockInput) {
        suggestions.style.display = 'none';
    }
});

// é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // åŠ è½½æœ€è¿‘é¢„æµ‹
    loadRecentPredictions();
    
    // åŠ è½½çƒ­é—¨è‚¡ç¥¨
    loadPopularStocks('all');
    
    // åŠ è½½å¸‚åœºæ¦‚è§ˆ
    loadMarketOverview();
    
    // æ¨¡æ‹Ÿå®æ—¶æ•°æ®æ›´æ–°
    setInterval(updateStats, 30000);
    
    // æ˜¾ç¤ºæ¬¢è¿æç¤º
    setTimeout(() => {
        showToast('æ¬¢è¿ä½¿ç”¨ Kronos æ™ºèƒ½æŠ•èµ„å¹³å°ï¼', 'info');
    }, 1000);
});

function loadRecentPredictions() {
    const container = document.getElementById('recent-predictions-grid');
    const recentPredictions = [
        {
            id: 'pred_001',
            stock: { symbol: '600519', name: 'è´µå·èŒ…å°' },
            modelType: 'kronos-base',
            days: 5,
            currentPrice: 1695.50,
            predictedPrice: 1742.30,
            confidence: 85.2,
            timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 hours ago
            status: 'bullish'
        },
        {
            id: 'pred_002',
            stock: { symbol: '000001', name: 'å¹³å®‰é“¶è¡Œ' },
            modelType: 'kronos-mini',
            days: 3,
            currentPrice: 12.75,
            predictedPrice: 13.45,
            confidence: 78.9,
            timestamp: new Date(Date.now() - 6 * 60 * 60 * 1000), // 6 hours ago
            status: 'bullish'
        },
        {
            id: 'pred_003',
            stock: { symbol: '000002', name: 'ä¸‡ç§‘A' },
            modelType: 'kronos-small',
            days: 10,
            currentPrice: 18.90,
            predictedPrice: 17.85,
            confidence: 82.4,
            timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000), // 1 day ago
            status: 'bearish'
        }
    ];
    
    let html = '';
    recentPredictions.forEach(pred => {
        const changePercent = ((pred.predictedPrice - pred.currentPrice) / pred.currentPrice) * 100;
        const changeClass = changePercent > 0 ? 'text-success' : 'text-danger';
        const changeIcon = changePercent > 0 ? 'arrow-up' : 'arrow-down';
        const timeDiff = getTimeDifference(pred.timestamp);
        
        html += `
            <div class="prediction-card recent-prediction" onclick="viewPredictionDetail('${pred.id}')">
                <div class="prediction-header">
                    <div class="stock-info">
                        <span class="stock-code">${pred.stock.symbol}</span>
                        <span class="stock-name">${pred.stock.name}</span>
                    </div>
                    <span class="model-badge badge-${pred.modelType.replace('-', '')}">${pred.modelType}</span>
                </div>
                <div class="prediction-body">
                    <div class="price-info">
                        <div class="current-price">
                            <label>å½“å‰</label>
                            <span>Â¥${pred.currentPrice.toFixed(2)}</span>
                        </div>
                        <div class="predicted-price">
                            <label>é¢„æµ‹</label>
                            <span class="${changeClass}">Â¥${pred.predictedPrice.toFixed(2)}</span>
                        </div>
                    </div>
                    <div class="prediction-change">
                        <i class="fas fa-${changeIcon} ${changeClass}"></i>
                        <span class="${changeClass}">${changePercent > 0 ? '+' : ''}${changePercent.toFixed(2)}%</span>
                    </div>
                </div>
                <div class="prediction-footer">
                    <span class="confidence">ç½®ä¿¡åº¦: ${pred.confidence.toFixed(1)}%</span>
                    <span class="time-ago">${timeDiff}</span>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function loadPopularStocks(filter = 'all') {
    const container = document.getElementById('popular-stocks-grid');
    const allStocks = [
        { symbol: '600519', name: 'è´µå·èŒ…å°', price: 1695.50, change: 2.8, volume: '12.5ä¸‡æ‰‹', industry: 'finance' },
        { symbol: '000858', name: 'äº”ç²®æ¶²', price: 128.45, change: -0.67, volume: '8.9ä¸‡æ‰‹', industry: 'finance' },
        { symbol: '000063', name: 'ä¸­å…´é€šè®¯', price: 32.18, change: -2.11, volume: '45.2ä¸‡æ‰‹', industry: 'tech' },
        { symbol: '002415', name: 'æµ·åº·å¨è§†', price: 45.67, change: 1.23, volume: '23.1ä¸‡æ‰‹', industry: 'tech' },
        { symbol: '600036', name: 'æ‹›å•†é“¶è¡Œ', price: 35.20, change: 1.78, volume: '18.7ä¸‡æ‰‹', industry: 'finance' },
        { symbol: '600887', name: 'ä¼Šåˆ©è‚¡ä»½', price: 34.12, change: -0.45, volume: '15.3ä¸‡æ‰‹', industry: 'finance' },
        { symbol: '601318', name: 'ä¸­å›½å¹³å®‰', price: 56.78, change: 0.89, volume: '28.4ä¸‡æ‰‹', industry: 'finance' },
        { symbol: '000002', name: 'ä¸‡ç§‘A', price: 18.90, change: -1.56, volume: '67.8ä¸‡æ‰‹', industry: 'finance' }
    ];
    
    const filteredStocks = filter === 'all' ? allStocks : allStocks.filter(stock => stock.industry === filter);
    
    let html = '';
    filteredStocks.slice(0, 8).forEach(stock => {
        const changeClass = stock.change > 0 ? 'text-success' : 'text-danger';
        const changeSign = stock.change > 0 ? '+' : '';
        
        html += `
            <div class="stock-card" onclick="selectStock('${stock.symbol}', '${stock.name}')">
                <div class="stock-header">
                    <div class="stock-basic">
                        <span class="stock-code">${stock.symbol}</span>
                        <span class="stock-name">${stock.name}</span>
                    </div>
                    <div class="stock-price">
                        <span class="price">Â¥${stock.price}</span>
                        <span class="change ${changeClass}">
                            ${changeSign}${stock.change.toFixed(2)}%
                        </span>
                    </div>
                </div>
                <div class="stock-volume">
                    <i class="fas fa-chart-bar"></i>
                    <span>æˆäº¤é‡: ${stock.volume}</span>
                </div>
                <div class="stock-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); addToWatchlist('${stock.symbol}')">
                        <i class="fas fa-star"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success" onclick="event.stopPropagation(); quickPredict('${stock.symbol}')">
                        <i class="fas fa-zap"></i> å¿«é€Ÿé¢„æµ‹
                    </button>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function loadMarketOverview() {
    const container = document.getElementById('market-stats');
    const marketData = [
        { label: 'ä¸Šè¯æŒ‡æ•°', value: '3,247.32', change: 1.2, positive: true },
        { label: 'æ·±è¯æˆæŒ‡', value: '10,892.45', change: -0.8, positive: false },
        { label: 'åˆ›ä¸šæ¿æŒ‡', value: '2,156.78', change: 0.5, positive: true },
        { label: 'æ²ªæ·±300', value: '4,123.56', change: 0.9, positive: true }
    ];
    
    let html = '';
    marketData.forEach(item => {
        const changeClass = item.positive ? 'text-success' : 'text-danger';
        const changeSign = item.positive ? '+' : '';
        
        html += `
            <div class="stat-item">
                <span class="stat-label">${item.label}</span>
                <span class="stat-value ${changeClass}">${item.value} (${changeSign}${item.change.toFixed(1)}%)</span>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function filterStocks(filter) {
    // æ›´æ–°æ¿€æ´»çŠ¶æ€
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
    
    // é‡æ–°åŠ è½½è‚¡ç¥¨æ•°æ®
    loadPopularStocks(filter);
    
    showToast(`å·²åˆ‡æ¢åˆ°${getFilterName(filter)}è‚¡ç¥¨`, 'info');
}

function getFilterName(filter) {
    const names = {
        'all': 'å…¨éƒ¨',
        'tech': 'ç§‘æŠ€',
        'finance': 'é‡‘è',
        'energy': 'èƒ½æº'
    };
    return names[filter] || 'å…¨éƒ¨';
}

function getTimeDifference(timestamp) {
    const now = new Date();
    const diff = Math.floor((now - timestamp) / (1000 * 60)); // minutes
    
    if (diff < 60) {
        return `${diff}åˆ†é’Ÿå‰`;
    } else if (diff < 1440) {
        return `${Math.floor(diff / 60)}å°æ—¶å‰`;
    } else {
        return `${Math.floor(diff / 1440)}å¤©å‰`;
    }
}

function viewPredictionDetail(predictionId) {
    showToast('é¢„æµ‹è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­...', 'info');
}

function updateStats() {
    // æ¨¡æ‹Ÿç»Ÿè®¡æ•°æ®æ›´æ–°
    const statValues = document.querySelectorAll('.stat-value');
    statValues.forEach(stat => {
        const text = stat.textContent;
        if (text.includes('%')) {
            // æ›´æ–°ç™¾åˆ†æ¯”
            const num = parseFloat(text);
            if (!isNaN(num)) {
                const change = (Math.random() - 0.5) * 2;
                const newNum = Math.max(0, Math.min(100, num + change));
                stat.textContent = newNum.toFixed(1) + '%';
            }
        } else if (text.includes('Â¥')) {
            // æ›´æ–°é‡‘é¢
            const num = parseFloat(text.replace(/[Â¥,M]/g, ''));
            if (!isNaN(num)) {
                const change = (Math.random() - 0.5) * 0.2;
                const newNum = Math.max(0, num + change);
                stat.textContent = 'Â¥' + newNum.toFixed(1) + 'M';
            }
        } else {
            // æ›´æ–°æ•°å­—
            const num = parseInt(text.replace(/,/g, ''));
            if (!isNaN(num)) {
                const change = Math.floor((Math.random() - 0.5) * 20);
                const newNum = Math.max(0, num + change);
                stat.textContent = newNum.toLocaleString();
            }
        }
    });
}

function filterStocks(filter) {
    // æ›´æ–°æ¿€æ´»çŠ¶æ€
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
    
    // é‡æ–°åŠ è½½è‚¡ç¥¨æ•°æ®
    loadPopularStocks(filter);
    
    showToast(`å·²åˆ‡æ¢åˆ°${getFilterName(filter)}è‚¡ç¥¨`, 'info');
}

function getFilterName(filter) {
    const names = {
        'all': 'å…¨éƒ¨',
        'tech': 'ç§‘æŠ€',
        'finance': 'é‡‘è',
        'energy': 'èƒ½æº'
    };
    return names[filter] || 'å…¨éƒ¨';
}

function getTimeDifference(timestamp) {
    const now = new Date();
    const diff = Math.floor((now - timestamp) / (1000 * 60)); // minutes
    
    if (diff < 60) {
        return `${diff}åˆ†é’Ÿå‰`;
    } else if (diff < 1440) {
        return `${Math.floor(diff / 60)}å°æ—¶å‰`;
    } else {
        return `${Math.floor(diff / 1440)}å¤©å‰`;
    }
}

function viewPredictionDetail(predictionId) {
    showToast('é¢„æµ‹è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­...', 'info');
}

function quickPredict(symbol) {
    document.getElementById('stock_symbol').value = symbol;
    document.getElementById('prediction-area').scrollIntoView({ behavior: 'smooth' });
    showToast(`å·²ä¸º ${symbol} é¢„å¡«å†™é¢„æµ‹è¡¨å•`, 'success');
}

function updateStats() {
    // æ¨¡æ‹Ÿç»Ÿè®¡æ•°æ®æ›´æ–°
    const statValues = document.querySelectorAll('.stat-value');
    statValues.forEach(stat => {
        const text = stat.textContent;
        if (text.includes('%')) {
            // æ›´æ–°ç™¾åˆ†æ¯”
            const num = parseFloat(text);
            if (!isNaN(num)) {
                const change = (Math.random() - 0.5) * 2;
                const newNum = Math.max(0, Math.min(100, num + change));
                stat.textContent = newNum.toFixed(1) + '%';
            }
        } else if (text.includes('Â¥')) {
            // æ›´æ–°é‡‘é¢
            const num = parseFloat(text.replace(/[Â¥,M]/g, ''));
            if (!isNaN(num)) {
                const change = (Math.random() - 0.5) * 0.2;
                const newNum = Math.max(0, num + change);
                stat.textContent = 'Â¥' + newNum.toFixed(1) + 'M';
            }
        } else {
            // æ›´æ–°æ•°å­—
            const num = parseInt(text.replace(/,/g, ''));
            if (!isNaN(num)) {
                const change = Math.floor((Math.random() - 0.5) * 20);
                const newNum = Math.max(0, num + change);
                stat.textContent = newNum.toLocaleString();
            }
        }
    });
}
</script>

<!-- CSSæ ·å¼ -->
<style>
/* è‚¡ç¥¨æœç´¢å»ºè®®æ ·å¼ */
.suggestions-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #ddd;
    border-top: none;
    border-radius: 0 0 8px 8px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    display: none;
}

.suggestion-item {
    padding: 12px 16px;
    cursor: pointer;
    border-bottom: 1px solid #f5f5f5;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color 0.2s ease;
}

.suggestion-item:hover {
    background: linear-gradient(90deg, #f8f9fa, #e9ecef);
}

.suggestion-item:last-child {
    border-bottom: none;
}

.stock-basic {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.stock-code {
    font-family: 'Courier New', monospace;
    font-weight: 700;
    color: #495057;
    font-size: 0.9rem;
}

.stock-name {
    color: #6c757d;
    font-size: 0.85rem;
}

.stock-price {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    text-align: right;
}

.price {
    font-weight: 600;
    color: #212529;
    font-size: 0.9rem;
}

.change {
    font-size: 0.75rem;
    font-weight: 500;
}

.no-results {
    padding: 20px;
    text-align: center;
    color: #6c757d;
    font-style: italic;
    background: #f8f9fa;
}

/* é¢„æµ‹åŠ è½½åŠ¨ç”» */
.prediction-loading {
    text-align: center;
    padding: 40px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    margin: 20px 0;
}

.loading-spinner {
    font-size: 3rem;
    margin-bottom: 20px;
    color: #ffd700;
}

.loading-spinner i {
    animation: spin 2s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.loading-progress {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,0.2);
    border-radius: 3px;
    overflow: hidden;
    margin-top: 20px;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #ffd700, #ff6b35);
    border-radius: 3px;
    transition: width 0.3s ease;
    width: 0%;
}

/* é¢„æµ‹ç»“æœæ ·å¼ */
.prediction-result-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    margin: 20px 0;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    animation: fadeInUp 0.5s ease;
}

@keyframes fadeInUp {
    from { 
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e9ecef;
}

.stock-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.stock-name {
    margin: 0;
    color: #212529;
    font-size: 1.2rem;
}

.stock-code {
    background: #f8f9fa;
    padding: 4px 8px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    color: #495057;
    font-size: 0.85rem;
}

.model-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.badge-kronosbase {
    background: linear-gradient(45deg, #667eea, #764ba2);
    color: white;
}

.badge-kronosmini {
    background: linear-gradient(45deg, #f093fb, #f5576c);
    color: white;
}

.badge-kronossmall {
    background: linear-gradient(45deg, #4facfe, #00f2fe);
    color: white;
}

.prediction-meta {
    text-align: right;
    color: #6c757d;
    font-size: 0.85rem;
}

.price-comparison {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin: 20px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.price-item {
    text-align: center;
    flex: 1;
}

.price-item label {
    display: block;
    font-size: 0.8rem;
    color: #6c757d;
    margin-bottom: 5px;
}

.price-value {
    font-size: 1.4rem;
    font-weight: 700;
}

.price-arrow {
    font-size: 2rem;
    padding: 0 10px;
}

.prediction-metrics {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 20px 0;
}

.metric-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.metric-item label {
    display: block;
    font-size: 0.8rem;
    color: #6c757d;
    margin-bottom: 5px;
}

.metric-value {
    font-size: 1.2rem;
    font-weight: 700;
}

.confidence-bar {
    margin-top: 8px;
    height: 6px;
    background: #e9ecef;
    border-radius: 3px;
    overflow: hidden;
}

.confidence-fill {
    height: 100%;
    background: linear-gradient(90deg, #dc3545, #ffc107, #28a745);
    transition: width 0.3s ease;
}

.prediction-analysis {
    margin: 20px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.prediction-analysis h6 {
    margin-bottom: 10px;
    color: #495057;
}

.analysis-points {
    margin: 0;
    padding-left: 20px;
}

.analysis-points li {
    margin-bottom: 5px;
    color: #6c757d;
}

.risk-warning {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px;
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 6px;
    margin: 15px 0;
}

.risk-warning i {
    color: #f39c12;
}

.risk-warning small {
    color: #856404;
    margin: 0;
}

.result-actions {
    display: flex;
    gap: 10px;
    padding-top: 15px;
    border-top: 1px solid #e9ecef;
}

/* Toast æç¤ºæ ·å¼ */
.toast-message {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    min-width: 300px;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    animation: slideInRight 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

@keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOutRight {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .price-comparison {
        flex-direction: column;
        gap: 15px;
    }
    
    .prediction-metrics {
        grid-template-columns: 1fr;
    }
    
    .result-actions {
        flex-wrap: wrap;
    }
    
    .stock-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
}

/* æœ€è¿‘é¢„æµ‹å¡ç‰‡æ ·å¼ */
.recent-prediction {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.recent-prediction:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-color: #007bff;
}

.prediction-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.prediction-body {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.price-info {
    display: flex;
    gap: 20px;
}

.current-price, .predicted-price {
    text-align: center;
}

.current-price label, .predicted-price label {
    display: block;
    font-size: 0.75rem;
    color: #6c757d;
    margin-bottom: 2px;
}

.current-price span, .predicted-price span {
    font-weight: 600;
    font-size: 0.9rem;
}

.prediction-change {
    display: flex;
    align-items: center;
    gap: 4px;
    font-weight: 600;
}

.prediction-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
    color: #6c757d;
    border-top: 1px solid #f1f3f4;
    padding-top: 8px;
}

/* è‚¡ç¥¨å¡ç‰‡æ ·å¼ */
.stock-card {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.stock-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-color: #28a745;
}

.stock-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.stock-volume {
    display: flex;
    align-items: center;
    gap: 6px;
    color: #6c757d;
    font-size: 0.85rem;
    margin-bottom: 12px;
}

.stock-actions {
    display: flex;
    gap: 8px;
    justify-content: space-between;
}

.stock-actions .btn {
    flex: 1;
    font-size: 0.8rem;
    padding: 4px 8px;
}

/* ç­›é€‰æ ‡ç­¾æ ·å¼ */
.filter-tabs {
    display: flex;
    gap: 8px;
}

.filter-tab {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    color: #6c757d;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.filter-tab:hover {
    background: #e9ecef;
    border-color: #ced4da;
}

.filter-tab.active {
    background: #007bff;
    border-color: #007bff;
    color: white;
}

/* ç½‘æ ¼å¸ƒå±€ */
.predictions-grid {
    display: grid;
    gap: 16px;
}

.stocks-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    margin-top: 16px;
}

@media (max-width: 768px) {
    .stocks-grid {
        grid-template-columns: 1fr;
    }
    
    .filter-tabs {
        flex-wrap: wrap;
    }
    
    .stock-actions {
        flex-direction: column;
    }
}
</style>

{% endblock %}