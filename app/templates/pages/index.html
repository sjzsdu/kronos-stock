{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <!-- Model Status Section -->
    <section class="card model-section">
        <h2>模型状态</h2>
        <div id="model-status" 
             hx-get="{{ url_for('views.model_status_component') }}"
             hx-trigger="load, model-loaded from:body">
            <div class="loading">加载中...</div>
        </div>
    </section>

    <!-- Prediction Form Section -->
    <section class="card prediction-section">
        <h2>股票预测</h2>
        <div id="prediction-form"
             hx-get="{{ url_for('views.prediction_form_component') }}"
             hx-trigger="load">
            <div class="loading">加载中...</div>
        </div>
    </section>

    <!-- Results Section -->
    <section class="card results-section">
        <h2>预测结果</h2>
        <div id="prediction-results">
            <div class="placeholder">
                <p>请先选择股票代码并点击预测按钮</p>
            </div>
        </div>
    </section>

    <!-- Chart Section -->
    <section class="card chart-section">
        <h2>价格走势图</h2>
        <div id="chart-container">
            <div class="placeholder">
                <p>图表将在预测完成后显示</p>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
// HTMX event handlers
document.body.addEventListener('htmx:afterRequest', function(event) {
    if (event.detail.target.id === 'prediction-results') {
        // Update chart after prediction
        const stockCode = document.querySelector('input[name="stock_code"]')?.value;
        if (stockCode) {
            htmx.ajax('GET', '/components/chart-container?stock_code=' + stockCode, {
                target: '#chart-container'
            });
        }
    }
});

// Form validation
document.body.addEventListener('htmx:configRequest', function(event) {
    if (event.detail.path === '/components/prediction-result') {
        const form = event.detail.elt;
        const stockCode = form.querySelector('input[name="stock_code"]')?.value;
        
        if (!stockCode) {
            event.preventDefault();
            alert('请输入股票代码');
            return false;
        }
    }
});
</script>
{% endblock %}